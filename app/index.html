<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vehicle Telemetry Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- CORS Warning -->
        <div id="cors-warning" class="cors-warning">
            <div class="container">
                <p>‚ö†Ô∏è <strong>Backend CORS Setup Required:</strong> Add the following to your FastAPI backend to enable CORS:</p>
                <code>pip install fastapi-cors && app.add_middleware(CORSMiddleware, allow_origins=["*"], allow_credentials=True, allow_methods=["*"], allow_headers=["*"])</code>
                <button onclick="dismissCorsWarning()">‚úï Dismiss</button>
            </div>
        </div>

        <!-- Header -->
        <header class="app-header">
            <div class="container">
                <h1>üöó Vehicle Telemetry Dashboard</h1>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <div class="container">
                <ul class="tab-list">
                    <li><button class="tab-btn active" data-tab="dashboard">üìä Dashboard</button></li>
                    <li><button class="tab-btn" data-tab="register">üÜï Register Vehicle</button></li>
                    <li><button class="tab-btn" data-tab="add-telemetry">‚ûï Add Telemetry</button></li>
                    <li><button class="tab-btn" data-tab="view-telemetry">üìã View Telemetry</button></li>
                    <li><button class="tab-btn" data-tab="filter-data">üîç Filter Data</button></li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Dashboard Tab -->
                <div id="dashboard" class="tab-content active">
                    <div class="dashboard-welcome">
                        <h2>Welcome to Vehicle Telemetry Dashboard</h2>
                        <p>Manage your vehicle fleet and monitor real-time telemetry data.</p>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Total Vehicles</h3>
                            <div class="stat-value" id="total-vehicles">-</div>
                        </div>
                        <div class="stat-card">
                            <h3>Total Records</h3>
                            <div class="stat-value" id="total-records">-</div>
                        </div>
                        <div class="stat-card">
                            <h3>Latest Update</h3>
                            <div class="stat-value" id="latest-update">-</div>
                        </div>
                    </div>

                    <div class="recent-data">
                        <h3>Recent Telemetry Data</h3>
                        <div class="table-container">
                            <table id="recent-telemetry-table">
                                <thead>
                                    <tr>
                                        <th>Vehicle ID</th>
                                        <th>Timestamp</th>
                                        <th>Speed</th>
                                        <th>Fuel Level</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-telemetry-body">
                                    <tr>
                                        <td colspan="4" class="loading">Loading recent data...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Register Vehicle Tab -->
                <div id="register" class="tab-content">
                    <div class="form-container">
                        <h2>Register New Vehicle</h2>
                        <form id="register-form">
                            <div class="form-group">
                                <label class="form-label" for="vehicle-id">Vehicle ID</label>
                                <input type="text" id="vehicle-id" class="form-control" placeholder="e.g., VH001" required>
                            </div>
                            <button type="submit" class="btn btn--primary">Register Vehicle</button>
                        </form>
                        
                        <div id="register-result" class="register-result hidden">
                            <h3>Registration Successful!</h3>
                            <div class="api-key-display">
                                <label>API Key:</label>
                                <div class="api-key-container">
                                    <input type="text" id="generated-api-key" class="form-control" readonly>
                                    <button type="button" id="copy-api-key" class="btn btn--secondary">Copy</button>
                                </div>
                            </div>
                            <p class="warning-text">‚ö†Ô∏è Please save this API key securely. You'll need it to add and manage telemetry data.</p>
                        </div>
                    </div>
                </div>

                <!-- Add Telemetry Tab -->
                <div id="add-telemetry" class="tab-content">
                    <div class="form-container">
                        <h2>Add Telemetry Data</h2>
                        <form id="telemetry-form">
                            <div class="form-group">
                                <label class="form-label" for="telemetry-vehicle-id">Vehicle ID</label>
                                <input type="text" id="telemetry-vehicle-id" class="form-control" placeholder="e.g., VH001" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="telemetry-api-key">API Key</label>
                                <input type="text" id="telemetry-api-key" class="form-control" placeholder="Enter your API key" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="lat">Latitude</label>
                                    <input type="number" id="lat" class="form-control" step="any" placeholder="40.7128" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="log">Longitude</label>
                                    <input type="number" id="log" class="form-control" step="any" placeholder="-74.0060" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="speed">Speed (mph)</label>
                                    <input type="number" id="speed" class="form-control" step="0.1" min="0" placeholder="65.5" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="fuel-level">Fuel Level (%)</label>
                                    <input type="number" id="fuel-level" class="form-control" step="0.1" min="0" max="100" placeholder="85.2" required>
                                </div>
                            </div>
                            <button type="submit" class="btn btn--primary">Add Telemetry Data</button>
                        </form>
                    </div>
                </div>

                <!-- View Telemetry Tab -->
                <div id="view-telemetry" class="tab-content">
                    <div class="telemetry-view">
                        <h2>All Telemetry Data</h2>
                        <div class="table-controls">
                            <button id="refresh-data" class="btn btn--secondary">üîÑ Refresh</button>
                            <div class="pagination-info">
                                <span id="pagination-text">Loading...</span>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table id="telemetry-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Vehicle ID</th>
                                        <th>Timestamp</th>
                                        <th>Speed</th>
                                        <th>Latitude</th>
                                        <th>Longitude</th>
                                        <th>Fuel Level</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="telemetry-body">
                                    <tr>
                                        <td colspan="8" class="loading">Loading data...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="pagination-controls">
                            <button id="prev-page" class="btn btn--outline">‚Üê Previous</button>
                            <span id="page-info">Page 1</span>
                            <button id="next-page" class="btn btn--outline">Next ‚Üí</button>
                        </div>
                    </div>
                </div>

                <!-- Filter Data Tab -->
                <div id="filter-data" class="tab-content">
                    <div class="filter-container">
                        <h2>Filter Telemetry Data</h2>
                        <form id="filter-form">
                            <div class="form-group">
                                <label class="form-label" for="filter-api-key">API Key</label>
                                <input type="text" id="filter-api-key" class="form-control" placeholder="Enter your API key" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="start-date">Start Date</label>
                                    <input type="date" id="start-date" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="end-date">End Date</label>
                                    <input type="date" id="end-date" class="form-control" required>
                                </div>
                            </div>
                            <div class="filter-buttons">
                                <button type="submit" class="btn btn--primary">Apply Filter</button>
                                <button type="button" id="clear-filters" class="btn btn--outline">Clear</button>
                            </div>
                        </form>
                        
                        <div id="filter-results" class="filter-results hidden">
                            <h3>Filter Results</h3>
                            <div class="table-container">
                                <table id="filtered-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Vehicle ID</th>
                                            <th>Timestamp</th>
                                            <th>Speed</th>
                                            <th>Latitude</th>
                                            <th>Longitude</th>
                                            <th>Fuel Level</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="filtered-body">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Toast Messages -->
        <div id="toast-container" class="toast-container"></div>

        <!-- Edit Modal -->
        <div id="edit-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Edit Telemetry Data</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="edit-form">
                        <input type="hidden" id="edit-telemetry-id">
                        <div class="form-group">
                            <label class="form-label" for="edit-api-key-input">API Key</label>
                            <input type="text" id="edit-api-key-input" class="form-control" placeholder="Enter your API key" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="edit-vehicle-id">Vehicle ID</label>
                            <input type="text" id="edit-vehicle-id" class="form-control" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="edit-lat">Latitude</label>
                                <input type="number" id="edit-lat" class="form-control" step="any" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="edit-log">Longitude</label>
                                <input type="number" id="edit-log" class="form-control" step="any" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label" for="edit-speed">Speed (mph)</label>
                                <input type="number" id="edit-speed" class="form-control" step="0.1" min="0" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="edit-fuel-level">Fuel Level (%)</label>
                                <input type="number" id="edit-fuel-level" class="form-control" step="0.1" min="0" max="100" required>
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button type="button" class="btn btn--outline modal-cancel">Cancel</button>
                            <button type="submit" class="btn btn--primary">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div id="delete-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Delete Telemetry Record</h3>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this telemetry record? This action cannot be undone.</p>
                    <div class="form-group">
                        <label class="form-label" for="delete-api-key-input">API Key</label>
                        <input type="text" id="delete-api-key-input" class="form-control" placeholder="Enter your API key" required>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn--outline modal-cancel">Cancel</button>
                        <button type="button" id="confirm-delete" class="btn btn--primary" style="background-color: var(--color-error);">Delete Record</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="loading-overlay hidden">
            <div class="loading-spinner"></div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>